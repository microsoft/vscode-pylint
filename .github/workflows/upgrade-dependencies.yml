name: Upgrade Dependencies

on:
  schedule:
    # Run weekly on Monday at 9:00 AM UTC
    - cron: '0 9 * * 1'
  workflow_dispatch: # Allow manual trigger

env:
  PYTHON_VERSION: '3.10'

jobs:
  upgrade-dependencies:
    name: Upgrade Dependencies
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Use Python ${{ env.PYTHON_VERSION }}
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: Install uv
        uses: astral-sh/setup-uv@v5

      - name: Upgrade requirements.txt
        run: |
          uv pip compile --generate-hashes --upgrade -o ./requirements.txt ./requirements.in

      - name: Upgrade dev-requirements.txt
        run: |
          uv pip compile --generate-hashes --upgrade -o ./dev-requirements.txt ./dev-requirements.in

      - name: Upgrade src/test/python_tests/requirements.txt
        run: |
          uv pip compile --generate-hashes --upgrade -o ./src/test/python_tests/requirements.txt ./src/test/python_tests/requirements.in

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v7
        with:
          commit-message: 'Upgrade Python dependencies'
          title: '[Bot] Upgrade Python dependencies'
          body: |
            This PR upgrades Python dependencies using `uv pip compile --upgrade`.
            Dependencies are updated to be compatible with **Python ${{ env.PYTHON_VERSION }}**.

            **Files updated:**
            - `requirements.txt`
            - `dev-requirements.txt`
            - `src/test/python_tests/requirements.txt`

            Please review the changes and ensure all tests pass before merging.
          branch: automated/upgrade-dependencies
          delete-branch: true
          labels: dependencies
